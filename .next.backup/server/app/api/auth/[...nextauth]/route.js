"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/[...nextauth]/route";
exports.ids = ["app/api/auth/[...nextauth]/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2Fapp%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2Fapp%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _app_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/auth/[...nextauth]/route.ts */ \"(rsc)/./app/api/auth/[...nextauth]/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_app_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_app_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/[...nextauth]/route\",\n        pathname: \"/api/auth/[...nextauth]\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/[...nextauth]/route\"\n    },\n    resolvedPagePath: \"/app/app/api/auth/[...nextauth]/route.ts\",\n    nextConfigOutput,\n    userland: _app_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/[...nextauth]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGJTVCLi4ubmV4dGF1dGglNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZhcHAlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmFwcCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDUjtBQUNyRTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2VjaG9zb2ZtZS8/MDI0OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvYXBwL2FwcC9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL1suLi5uZXh0YXV0aF1cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9hcHAvYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2Fapp%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/auth/[...nextauth]/route.ts":
/*!*********************************************!*\
  !*** ./app/api/auth/[...nextauth]/route.ts ***!
  \*********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ handler),\n/* harmony export */   POST: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_auth__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_auth__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst handler = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(_lib_auth__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFnQztBQUNRO0FBRXhDLE1BQU1FLFVBQVVGLGdEQUFRQSxDQUFDQyxrREFBV0E7QUFFTSIsInNvdXJjZXMiOlsid2VicGFjazovL2VjaG9zb2ZtZS8uL2FwcC9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlLnRzP2M4YTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE5leHRBdXRoIGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCB7IGF1dGhPcHRpb25zIH0gZnJvbSAnQC9saWIvYXV0aCdcblxuY29uc3QgaGFuZGxlciA9IE5leHRBdXRoKGF1dGhPcHRpb25zKVxuXG5leHBvcnQgeyBoYW5kbGVyIGFzIEdFVCwgaGFuZGxlciBhcyBQT1NUIH0iXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJhdXRoT3B0aW9ucyIsImhhbmRsZXIiLCJHRVQiLCJQT1NUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/[...nextauth]/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/admin-security.ts":
/*!*******************************!*\
  !*** ./lib/admin-security.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createShadowSession: () => (/* binding */ createShadowSession),\n/* harmony export */   detectCrisisInContent: () => (/* binding */ detectCrisisInContent),\n/* harmony export */   endShadowSession: () => (/* binding */ endShadowSession),\n/* harmony export */   getClientIP: () => (/* binding */ getClientIP),\n/* harmony export */   getGriefSensitiveErrorMessage: () => (/* binding */ getGriefSensitiveErrorMessage),\n/* harmony export */   hashAdminPassword: () => (/* binding */ hashAdminPassword),\n/* harmony export */   isIPBlocked: () => (/* binding */ isIPBlocked),\n/* harmony export */   logAdminAction: () => (/* binding */ logAdminAction),\n/* harmony export */   processPrivacyRequest: () => (/* binding */ processPrivacyRequest),\n/* harmony export */   recordShadowAction: () => (/* binding */ recordShadowAction),\n/* harmony export */   validateShadowSession: () => (/* binding */ validateShadowSession),\n/* harmony export */   verifyAdminPassword: () => (/* binding */ verifyAdminPassword),\n/* harmony export */   verifyAdminPermission: () => (/* binding */ verifyAdminPermission),\n/* harmony export */   verifyAdminSession: () => (/* binding */ verifyAdminSession)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"(rsc)/./node_modules/next-auth/next/index.js\");\n/* harmony import */ var _auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_4__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_0__, _auth__WEBPACK_IMPORTED_MODULE_2__]);\n([_db__WEBPACK_IMPORTED_MODULE_0__, _auth__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n// Check if user is admin with specific permission\nasync function verifyAdminPermission(email, permission) {\n    try {\n        const result = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n      SELECT \n        u.id, u.email, u.name, u.is_admin, u.admin_role_id,\n        ar.role_name, ar.permissions\n      FROM users u\n      LEFT JOIN admin_roles ar ON u.admin_role_id = ar.id\n      WHERE u.email = $1 AND u.is_admin = true AND u.is_active = true\n    `, [\n            email\n        ]);\n        if (result.rows.length === 0) {\n            return {\n                isAuthorized: false,\n                error: \"User not found or not an admin\"\n            };\n        }\n        const user = result.rows[0];\n        if (!user.admin_role_id || !user.permissions) {\n            return {\n                isAuthorized: false,\n                error: \"Admin role not properly configured\"\n            };\n        }\n        // Check if user has the specific permission\n        const [resource, action] = permission.split(\".\");\n        const hasPermission = user.permissions[resource]?.includes(action);\n        if (!hasPermission) {\n            return {\n                isAuthorized: false,\n                user,\n                error: `Insufficient permissions for ${permission}`\n            };\n        }\n        return {\n            isAuthorized: true,\n            user\n        };\n    } catch (error) {\n        console.error(\"Error verifying admin permission:\", error);\n        return {\n            isAuthorized: false,\n            error: \"Database error\"\n        };\n    }\n}\n// Verify session and admin permissions\nasync function verifyAdminSession(permission, request) {\n    try {\n        const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session?.user?.email) {\n            return {\n                isAuthorized: false,\n                error: \"No valid session\"\n            };\n        }\n        const result = await verifyAdminPermission(session.user.email, permission);\n        // Log access attempt for audit\n        if (request) {\n            await logAdminAction({\n                admin_email: session.user.email,\n                action_type: \"permission_check\",\n                resource_type: \"admin_access\",\n                action_details: {\n                    permission,\n                    granted: result.isAuthorized\n                },\n                ip_address: getClientIP(request),\n                user_agent: request.headers.get(\"user-agent\") || undefined,\n                risk_level: result.isAuthorized ? \"low\" : \"medium\"\n            });\n        }\n        return result;\n    } catch (error) {\n        console.error(\"Error verifying admin session:\", error);\n        return {\n            isAuthorized: false,\n            error: \"Session verification failed\"\n        };\n    }\n}\n// Log admin actions for audit trail\nasync function logAdminAction(entry) {\n    try {\n        await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n      INSERT INTO comprehensive_audit_log (\n        admin_user_id, admin_email, action_type, resource_type, resource_id,\n        target_user_id, target_family_id, action_details, before_state, after_state,\n        ip_address, user_agent, session_id, risk_level, compliance_relevant,\n        created_at\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, CURRENT_TIMESTAMP)\n    `, [\n            entry.admin_user_id || null,\n            entry.admin_email,\n            entry.action_type,\n            entry.resource_type,\n            entry.resource_id || null,\n            entry.target_user_id || null,\n            entry.target_family_id || null,\n            entry.action_details ? JSON.stringify(entry.action_details) : null,\n            entry.before_state ? JSON.stringify(entry.before_state) : null,\n            entry.after_state ? JSON.stringify(entry.after_state) : null,\n            entry.ip_address || null,\n            entry.user_agent || null,\n            entry.session_id || null,\n            entry.risk_level || \"low\",\n            entry.compliance_relevant || false\n        ]);\n    } catch (error) {\n        console.error(\"Error logging admin action:\", error);\n    // Don't throw here to avoid breaking the main operation\n    }\n}\n// Generate secure shadow session token\nasync function createShadowSession(adminUserId, targetUserId, reason, privacyLevel = \"read_only\") {\n    const token = crypto__WEBPACK_IMPORTED_MODULE_4___default().randomBytes(32).toString(\"hex\");\n    const sessionId = crypto__WEBPACK_IMPORTED_MODULE_4___default().randomUUID();\n    await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n    INSERT INTO user_shadowing_sessions (\n      id, admin_user_id, target_user_id, session_token, shadow_reason, \n      privacy_level, session_started_at, is_active\n    ) VALUES ($1, $2, $3, $4, $5, $6, CURRENT_TIMESTAMP, true)\n  `, [\n        sessionId,\n        adminUserId,\n        targetUserId,\n        token,\n        reason,\n        privacyLevel\n    ]);\n    return {\n        token,\n        sessionId\n    };\n}\n// Validate shadow session\nasync function validateShadowSession(token) {\n    try {\n        const result = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n      SELECT \n        uss.*, \n        admin_user.email as admin_email,\n        target_user.email as target_email,\n        target_user.name as target_name\n      FROM user_shadowing_sessions uss\n      JOIN users admin_user ON uss.admin_user_id = admin_user.id\n      JOIN users target_user ON uss.target_user_id = target_user.id\n      WHERE uss.session_token = $1 AND uss.is_active = true\n        AND uss.session_started_at > NOW() - INTERVAL '24 hours'\n    `, [\n            token\n        ]);\n        if (result.rows.length === 0) {\n            return {\n                isValid: false,\n                error: \"Invalid or expired shadow session\"\n            };\n        }\n        return {\n            isValid: true,\n            session: result.rows[0]\n        };\n    } catch (error) {\n        console.error(\"Error validating shadow session:\", error);\n        return {\n            isValid: false,\n            error: \"Session validation failed\"\n        };\n    }\n}\n// End shadow session\nasync function endShadowSession(sessionId, adminNotes) {\n    await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n    UPDATE user_shadowing_sessions \n    SET is_active = false, session_ended_at = CURRENT_TIMESTAMP, session_notes = $2\n    WHERE id = $1\n  `, [\n        sessionId,\n        adminNotes || null\n    ]);\n}\n// Record shadow session action\nasync function recordShadowAction(sessionId, action, details, sensitiveDataAccessed = false) {\n    await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n    UPDATE user_shadowing_sessions \n    SET \n      actions_performed = actions_performed || $2::jsonb,\n      sensitive_data_accessed = sensitive_data_accessed OR $3\n    WHERE id = $1\n  `, [\n        sessionId,\n        JSON.stringify([\n            {\n                action,\n                details,\n                timestamp: new Date().toISOString()\n            }\n        ]),\n        sensitiveDataAccessed\n    ]);\n}\n// Grief-sensitive error messages\nfunction getGriefSensitiveErrorMessage(error) {\n    const sensitiveMessages = {\n        \"insufficient_permissions\": \"We understand this is important to you. Please contact our support team who can help with your request.\",\n        \"user_not_found\": \"We cannot locate the requested information. Our team is here to help you find what you need.\",\n        \"family_not_found\": \"This family information is not available. Please reach out if you need assistance.\",\n        \"crisis_detected\": \"We notice you may need some support right now. A caring team member will reach out to you soon.\",\n        \"data_processing_error\": \"There was a temporary issue processing your request. Please try again or contact our support team.\",\n        \"unauthorized_access\": \"For privacy and security, access to this information is restricted. Our team can help if you need assistance.\",\n        \"session_expired\": \"Your session has ended. Please sign in again to continue.\",\n        \"rate_limited\": \"Please take a moment before trying again. Our team is here if you need immediate assistance.\"\n    };\n    return sensitiveMessages[error] || \"Something went wrong, but our caring team is here to help. Please contact support.\";\n}\n// Hash password for admin users\nasync function hashAdminPassword(password) {\n    const saltRounds = 12 // Higher security for admin accounts\n    ;\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().hash(password, saltRounds);\n}\n// Verify admin password\nasync function verifyAdminPassword(password, hash) {\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().compare(password, hash);\n}\n// Get client IP address from request\nfunction getClientIP(request) {\n    // Check various headers for client IP\n    const headers = [\n        \"x-forwarded-for\",\n        \"x-real-ip\",\n        \"x-client-ip\",\n        \"cf-connecting-ip\",\n        \"x-forwarded\",\n        \"forwarded-for\",\n        \"forwarded\"\n    ];\n    for (const header of headers){\n        const value = request.headers.get(header);\n        if (value) {\n            // Take the first IP if there are multiple\n            return value.split(\",\")[0].trim();\n        }\n    }\n    return null;\n}\n// Check if IP is blocked\nasync function isIPBlocked(ip) {\n    if (!ip) return false;\n    try {\n        const result = await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n      SELECT id FROM blocked_ips \n      WHERE ip_address = $1 AND (expires_at IS NULL OR expires_at > CURRENT_TIMESTAMP)\n    `, [\n            ip\n        ]);\n        return result.rows.length > 0;\n    } catch (error) {\n        console.error(\"Error checking blocked IP:\", error);\n        return false;\n    }\n}\n// Crisis detection helper\nasync function detectCrisisInContent(userId, content, familyId) {\n    // Simple keyword-based crisis detection (in production, use AI/ML)\n    const crisisKeywords = [\n        \"suicide\",\n        \"kill myself\",\n        \"end it all\",\n        \"can't go on\",\n        \"hopeless\",\n        \"worthless\",\n        \"burden\",\n        \"better off dead\",\n        \"nobody cares\",\n        \"give up\"\n    ];\n    const griefKeywords = [\n        \"overwhelming\",\n        \"can't cope\",\n        \"intense pain\",\n        \"unbearable\",\n        \"alone\",\n        \"empty\",\n        \"devastated\",\n        \"lost\",\n        \"abandoned\"\n    ];\n    const lowerContent = content.toLowerCase();\n    const crisisMatches = crisisKeywords.filter((keyword)=>lowerContent.includes(keyword));\n    const griefMatches = griefKeywords.filter((keyword)=>lowerContent.includes(keyword));\n    let severity = 1;\n    let needsIntervention = false;\n    const suggestions = [];\n    if (crisisMatches.length > 0) {\n        severity = Math.min(10, 7 + crisisMatches.length);\n        needsIntervention = true;\n        suggestions.push(\"Immediate crisis intervention required\");\n        suggestions.push(\"Contact emergency services if imminent danger\");\n        suggestions.push(\"Provide crisis hotline numbers\");\n    } else if (griefMatches.length > 2) {\n        severity = Math.min(6, 3 + griefMatches.length);\n        needsIntervention = true;\n        suggestions.push(\"Emotional support needed\");\n        suggestions.push(\"Consider grief counseling resources\");\n        suggestions.push(\"Schedule follow-up check-in\");\n    }\n    // Log the detection event\n    if (needsIntervention) {\n        await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n      INSERT INTO crisis_detection_events (\n        user_id, family_id, event_type, severity_level, trigger_content,\n        keywords_detected, response_suggestion, status, created_at\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, 'active', CURRENT_TIMESTAMP)\n    `, [\n            userId,\n            familyId || null,\n            \"keyword_detection\",\n            severity,\n            content.substring(0, 500),\n            [\n                ...crisisMatches,\n                ...griefMatches\n            ],\n            suggestions.join(\"; \")\n        ]);\n    }\n    return {\n        needsIntervention,\n        severity,\n        suggestions\n    };\n}\n// Privacy compliance helpers\nasync function processPrivacyRequest(requestId, adminEmail, status, statusReason, dataExportedPath) {\n    await (0,_db__WEBPACK_IMPORTED_MODULE_0__.query)(`\n    UPDATE privacy_requests \n    SET \n      status = $2,\n      status_reason = $3,\n      processing_admin_email = $4,\n      completed_at = CURRENT_TIMESTAMP,\n      data_exported_path = $5\n    WHERE id = $1\n  `, [\n        requestId,\n        status,\n        statusReason || null,\n        adminEmail,\n        dataExportedPath || null\n    ]);\n    // Log the privacy action\n    await logAdminAction({\n        admin_email: adminEmail,\n        action_type: \"privacy_request_processed\",\n        resource_type: \"privacy_request\",\n        resource_id: requestId,\n        action_details: {\n            status,\n            statusReason,\n            dataExportedPath\n        },\n        risk_level: \"medium\",\n        compliance_relevant: true\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxnQkFBZ0I7WUFBRTRFO1lBQVFDO1lBQWNDO1FBQWlCO1FBQ3pEdEUsWUFBWTtRQUNaVyxxQkFBcUI7SUFDdkI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VjaG9zb2ZtZS8uL2xpYi9hZG1pbi1zZWN1cml0eS50cz81NzgzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHF1ZXJ5IH0gZnJvbSAnLi9kYidcbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgvbmV4dCdcbmltcG9ydCB7IGF1dGhPcHRpb25zIH0gZnJvbSAnLi9hdXRoJ1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcydcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJ1xuXG4vLyBBZG1pbiByb2xlIHBlcm1pc3Npb25zIG1hcHBpbmdcbmV4cG9ydCB0eXBlIEFkbWluUGVybWlzc2lvbiA9IFxuICB8ICd1c2Vycy5jcmVhdGUnIHwgJ3VzZXJzLnJlYWQnIHwgJ3VzZXJzLnVwZGF0ZScgfCAndXNlcnMuZGVsZXRlJyB8ICd1c2Vycy5zaGFkb3cnXG4gIHwgJ2ZhbWlsaWVzLmNyZWF0ZScgfCAnZmFtaWxpZXMucmVhZCcgfCAnZmFtaWxpZXMudXBkYXRlJyB8ICdmYW1pbGllcy5kZWxldGUnIHwgJ2ZhbWlsaWVzLm1hbmFnZScgfCAnZmFtaWxpZXMuc3VwcG9ydCdcbiAgfCAnY3Jpc2lzLnJlYWQnIHwgJ2NyaXNpcy5yZXNwb25kJyB8ICdjcmlzaXMuZXNjYWxhdGUnXG4gIHwgJ3ByaXZhY3kucmVhZCcgfCAncHJpdmFjeS5wcm9jZXNzJyB8ICdwcml2YWN5LmFwcHJvdmUnIHwgJ3ByaXZhY3kuZGVsZXRlJ1xuICB8ICdhbmFseXRpY3MucmVhZCcgfCAnYW5hbHl0aWNzLmV4cG9ydCdcbiAgfCAnYXVkaXQucmVhZCcgfCAnYXVkaXQuZXhwb3J0J1xuICB8ICdzeXN0ZW0uY29uZmlndXJlJyB8ICdzeXN0ZW0ubWFpbnRhaW4nIHwgJ3N5c3RlbS5iYWNrdXAnXG4gIHwgJ2FkbWluLmNyZWF0ZScgfCAnYWRtaW4ucmVhZCcgfCAnYWRtaW4udXBkYXRlJyB8ICdhZG1pbi5kZWxldGUnXG4gIHwgJ3N1cHBvcnQuY3JlYXRlJyB8ICdzdXBwb3J0LnJlYWQnIHwgJ3N1cHBvcnQudXBkYXRlJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEFkbWluVXNlciB7XG4gIGlkOiBzdHJpbmdcbiAgZW1haWw6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgaXNfYWRtaW46IGJvb2xlYW5cbiAgYWRtaW5fcm9sZV9pZDogc3RyaW5nIHwgbnVsbFxuICByb2xlX25hbWU6IHN0cmluZyB8IG51bGxcbiAgcGVybWlzc2lvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGl0TG9nRW50cnkge1xuICBhZG1pbl91c2VyX2lkPzogc3RyaW5nXG4gIGFkbWluX2VtYWlsOiBzdHJpbmdcbiAgYWN0aW9uX3R5cGU6IHN0cmluZ1xuICByZXNvdXJjZV90eXBlOiBzdHJpbmdcbiAgcmVzb3VyY2VfaWQ/OiBzdHJpbmdcbiAgdGFyZ2V0X3VzZXJfaWQ/OiBzdHJpbmdcbiAgdGFyZ2V0X2ZhbWlseV9pZD86IHN0cmluZ1xuICBhY3Rpb25fZGV0YWlscz86IGFueVxuICBiZWZvcmVfc3RhdGU/OiBhbnlcbiAgYWZ0ZXJfc3RhdGU/OiBhbnlcbiAgaXBfYWRkcmVzcz86IHN0cmluZ1xuICB1c2VyX2FnZW50Pzogc3RyaW5nXG4gIHNlc3Npb25faWQ/OiBzdHJpbmdcbiAgcmlza19sZXZlbD86ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnXG4gIGNvbXBsaWFuY2VfcmVsZXZhbnQ/OiBib29sZWFuXG59XG5cbi8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW4gd2l0aCBzcGVjaWZpYyBwZXJtaXNzaW9uXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QWRtaW5QZXJtaXNzaW9uKFxuICBlbWFpbDogc3RyaW5nLCBcbiAgcGVybWlzc2lvbjogQWRtaW5QZXJtaXNzaW9uXG4pOiBQcm9taXNlPHsgaXNBdXRob3JpemVkOiBib29sZWFuOyB1c2VyPzogQWRtaW5Vc2VyOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVlcnkoYFxuICAgICAgU0VMRUNUIFxuICAgICAgICB1LmlkLCB1LmVtYWlsLCB1Lm5hbWUsIHUuaXNfYWRtaW4sIHUuYWRtaW5fcm9sZV9pZCxcbiAgICAgICAgYXIucm9sZV9uYW1lLCBhci5wZXJtaXNzaW9uc1xuICAgICAgRlJPTSB1c2VycyB1XG4gICAgICBMRUZUIEpPSU4gYWRtaW5fcm9sZXMgYXIgT04gdS5hZG1pbl9yb2xlX2lkID0gYXIuaWRcbiAgICAgIFdIRVJFIHUuZW1haWwgPSAkMSBBTkQgdS5pc19hZG1pbiA9IHRydWUgQU5EIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgIGAsIFtlbWFpbF0pXG5cbiAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4geyBpc0F1dGhvcml6ZWQ6IGZhbHNlLCBlcnJvcjogJ1VzZXIgbm90IGZvdW5kIG9yIG5vdCBhbiBhZG1pbicgfVxuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSByZXN1bHQucm93c1swXSBhcyBBZG1pblVzZXJcbiAgICBcbiAgICBpZiAoIXVzZXIuYWRtaW5fcm9sZV9pZCB8fCAhdXNlci5wZXJtaXNzaW9ucykge1xuICAgICAgcmV0dXJuIHsgaXNBdXRob3JpemVkOiBmYWxzZSwgZXJyb3I6ICdBZG1pbiByb2xlIG5vdCBwcm9wZXJseSBjb25maWd1cmVkJyB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgdGhlIHNwZWNpZmljIHBlcm1pc3Npb25cbiAgICBjb25zdCBbcmVzb3VyY2UsIGFjdGlvbl0gPSBwZXJtaXNzaW9uLnNwbGl0KCcuJylcbiAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gdXNlci5wZXJtaXNzaW9uc1tyZXNvdXJjZV0/LmluY2x1ZGVzKGFjdGlvbilcblxuICAgIGlmICghaGFzUGVybWlzc2lvbikge1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIGlzQXV0aG9yaXplZDogZmFsc2UsIFxuICAgICAgICB1c2VyLCBcbiAgICAgICAgZXJyb3I6IGBJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgZm9yICR7cGVybWlzc2lvbn1gIFxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IGlzQXV0aG9yaXplZDogdHJ1ZSwgdXNlciB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdmVyaWZ5aW5nIGFkbWluIHBlcm1pc3Npb246JywgZXJyb3IpXG4gICAgcmV0dXJuIHsgaXNBdXRob3JpemVkOiBmYWxzZSwgZXJyb3I6ICdEYXRhYmFzZSBlcnJvcicgfVxuICB9XG59XG5cbi8vIFZlcmlmeSBzZXNzaW9uIGFuZCBhZG1pbiBwZXJtaXNzaW9uc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUFkbWluU2Vzc2lvbihcbiAgcGVybWlzc2lvbjogQWRtaW5QZXJtaXNzaW9uLFxuICByZXF1ZXN0PzogUmVxdWVzdFxuKTogUHJvbWlzZTx7IGlzQXV0aG9yaXplZDogYm9vbGVhbjsgdXNlcj86IEFkbWluVXNlcjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKGF1dGhPcHRpb25zKVxuICAgIFxuICAgIGlmICghc2Vzc2lvbj8udXNlcj8uZW1haWwpIHtcbiAgICAgIHJldHVybiB7IGlzQXV0aG9yaXplZDogZmFsc2UsIGVycm9yOiAnTm8gdmFsaWQgc2Vzc2lvbicgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZlcmlmeUFkbWluUGVybWlzc2lvbihzZXNzaW9uLnVzZXIuZW1haWwsIHBlcm1pc3Npb24pXG4gICAgXG4gICAgLy8gTG9nIGFjY2VzcyBhdHRlbXB0IGZvciBhdWRpdFxuICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICBhd2FpdCBsb2dBZG1pbkFjdGlvbih7XG4gICAgICAgIGFkbWluX2VtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWwsXG4gICAgICAgIGFjdGlvbl90eXBlOiAncGVybWlzc2lvbl9jaGVjaycsXG4gICAgICAgIHJlc291cmNlX3R5cGU6ICdhZG1pbl9hY2Nlc3MnLFxuICAgICAgICBhY3Rpb25fZGV0YWlsczogeyBwZXJtaXNzaW9uLCBncmFudGVkOiByZXN1bHQuaXNBdXRob3JpemVkIH0sXG4gICAgICAgIGlwX2FkZHJlc3M6IGdldENsaWVudElQKHJlcXVlc3QpLFxuICAgICAgICB1c2VyX2FnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgdW5kZWZpbmVkLFxuICAgICAgICByaXNrX2xldmVsOiByZXN1bHQuaXNBdXRob3JpemVkID8gJ2xvdycgOiAnbWVkaXVtJ1xuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdmVyaWZ5aW5nIGFkbWluIHNlc3Npb246JywgZXJyb3IpXG4gICAgcmV0dXJuIHsgaXNBdXRob3JpemVkOiBmYWxzZSwgZXJyb3I6ICdTZXNzaW9uIHZlcmlmaWNhdGlvbiBmYWlsZWQnIH1cbiAgfVxufVxuXG4vLyBMb2cgYWRtaW4gYWN0aW9ucyBmb3IgYXVkaXQgdHJhaWxcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBZG1pbkFjdGlvbihlbnRyeTogQXVkaXRMb2dFbnRyeSk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGF3YWl0IHF1ZXJ5KGBcbiAgICAgIElOU0VSVCBJTlRPIGNvbXByZWhlbnNpdmVfYXVkaXRfbG9nIChcbiAgICAgICAgYWRtaW5fdXNlcl9pZCwgYWRtaW5fZW1haWwsIGFjdGlvbl90eXBlLCByZXNvdXJjZV90eXBlLCByZXNvdXJjZV9pZCxcbiAgICAgICAgdGFyZ2V0X3VzZXJfaWQsIHRhcmdldF9mYW1pbHlfaWQsIGFjdGlvbl9kZXRhaWxzLCBiZWZvcmVfc3RhdGUsIGFmdGVyX3N0YXRlLFxuICAgICAgICBpcF9hZGRyZXNzLCB1c2VyX2FnZW50LCBzZXNzaW9uX2lkLCByaXNrX2xldmVsLCBjb21wbGlhbmNlX3JlbGV2YW50LFxuICAgICAgICBjcmVhdGVkX2F0XG4gICAgICApIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICQ1LCAkNiwgJDcsICQ4LCAkOSwgJDEwLCAkMTEsICQxMiwgJDEzLCAkMTQsICQxNSwgQ1VSUkVOVF9USU1FU1RBTVApXG4gICAgYCwgW1xuICAgICAgZW50cnkuYWRtaW5fdXNlcl9pZCB8fCBudWxsLFxuICAgICAgZW50cnkuYWRtaW5fZW1haWwsXG4gICAgICBlbnRyeS5hY3Rpb25fdHlwZSxcbiAgICAgIGVudHJ5LnJlc291cmNlX3R5cGUsXG4gICAgICBlbnRyeS5yZXNvdXJjZV9pZCB8fCBudWxsLFxuICAgICAgZW50cnkudGFyZ2V0X3VzZXJfaWQgfHwgbnVsbCxcbiAgICAgIGVudHJ5LnRhcmdldF9mYW1pbHlfaWQgfHwgbnVsbCxcbiAgICAgIGVudHJ5LmFjdGlvbl9kZXRhaWxzID8gSlNPTi5zdHJpbmdpZnkoZW50cnkuYWN0aW9uX2RldGFpbHMpIDogbnVsbCxcbiAgICAgIGVudHJ5LmJlZm9yZV9zdGF0ZSA/IEpTT04uc3RyaW5naWZ5KGVudHJ5LmJlZm9yZV9zdGF0ZSkgOiBudWxsLFxuICAgICAgZW50cnkuYWZ0ZXJfc3RhdGUgPyBKU09OLnN0cmluZ2lmeShlbnRyeS5hZnRlcl9zdGF0ZSkgOiBudWxsLFxuICAgICAgZW50cnkuaXBfYWRkcmVzcyB8fCBudWxsLFxuICAgICAgZW50cnkudXNlcl9hZ2VudCB8fCBudWxsLFxuICAgICAgZW50cnkuc2Vzc2lvbl9pZCB8fCBudWxsLFxuICAgICAgZW50cnkucmlza19sZXZlbCB8fCAnbG93JyxcbiAgICAgIGVudHJ5LmNvbXBsaWFuY2VfcmVsZXZhbnQgfHwgZmFsc2VcbiAgICBdKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgYWRtaW4gYWN0aW9uOicsIGVycm9yKVxuICAgIC8vIERvbid0IHRocm93IGhlcmUgdG8gYXZvaWQgYnJlYWtpbmcgdGhlIG1haW4gb3BlcmF0aW9uXG4gIH1cbn1cblxuLy8gR2VuZXJhdGUgc2VjdXJlIHNoYWRvdyBzZXNzaW9uIHRva2VuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2hhZG93U2Vzc2lvbihcbiAgYWRtaW5Vc2VySWQ6IHN0cmluZyxcbiAgdGFyZ2V0VXNlcklkOiBzdHJpbmcsXG4gIHJlYXNvbjogc3RyaW5nLFxuICBwcml2YWN5TGV2ZWw6ICdyZWFkX29ubHknIHwgJ2xpbWl0ZWRfaW50ZXJhY3Rpb24nIHwgJ2Z1bGxfc3VwcG9ydCcgPSAncmVhZF9vbmx5J1xuKTogUHJvbWlzZTx7IHRva2VuOiBzdHJpbmc7IHNlc3Npb25JZDogc3RyaW5nIH0+IHtcbiAgY29uc3QgdG9rZW4gPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpLnRvU3RyaW5nKCdoZXgnKVxuICBjb25zdCBzZXNzaW9uSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpXG5cbiAgYXdhaXQgcXVlcnkoYFxuICAgIElOU0VSVCBJTlRPIHVzZXJfc2hhZG93aW5nX3Nlc3Npb25zIChcbiAgICAgIGlkLCBhZG1pbl91c2VyX2lkLCB0YXJnZXRfdXNlcl9pZCwgc2Vzc2lvbl90b2tlbiwgc2hhZG93X3JlYXNvbiwgXG4gICAgICBwcml2YWN5X2xldmVsLCBzZXNzaW9uX3N0YXJ0ZWRfYXQsIGlzX2FjdGl2ZVxuICAgICkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCBDVVJSRU5UX1RJTUVTVEFNUCwgdHJ1ZSlcbiAgYCwgW3Nlc3Npb25JZCwgYWRtaW5Vc2VySWQsIHRhcmdldFVzZXJJZCwgdG9rZW4sIHJlYXNvbiwgcHJpdmFjeUxldmVsXSlcblxuICByZXR1cm4geyB0b2tlbiwgc2Vzc2lvbklkIH1cbn1cblxuLy8gVmFsaWRhdGUgc2hhZG93IHNlc3Npb25cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVNoYWRvd1Nlc3Npb24odG9rZW46IHN0cmluZyk6IFByb21pc2U8e1xuICBpc1ZhbGlkOiBib29sZWFuXG4gIHNlc3Npb24/OiBhbnlcbiAgZXJyb3I/OiBzdHJpbmdcbn0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeShgXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIHVzcy4qLCBcbiAgICAgICAgYWRtaW5fdXNlci5lbWFpbCBhcyBhZG1pbl9lbWFpbCxcbiAgICAgICAgdGFyZ2V0X3VzZXIuZW1haWwgYXMgdGFyZ2V0X2VtYWlsLFxuICAgICAgICB0YXJnZXRfdXNlci5uYW1lIGFzIHRhcmdldF9uYW1lXG4gICAgICBGUk9NIHVzZXJfc2hhZG93aW5nX3Nlc3Npb25zIHVzc1xuICAgICAgSk9JTiB1c2VycyBhZG1pbl91c2VyIE9OIHVzcy5hZG1pbl91c2VyX2lkID0gYWRtaW5fdXNlci5pZFxuICAgICAgSk9JTiB1c2VycyB0YXJnZXRfdXNlciBPTiB1c3MudGFyZ2V0X3VzZXJfaWQgPSB0YXJnZXRfdXNlci5pZFxuICAgICAgV0hFUkUgdXNzLnNlc3Npb25fdG9rZW4gPSAkMSBBTkQgdXNzLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgQU5EIHVzcy5zZXNzaW9uX3N0YXJ0ZWRfYXQgPiBOT1coKSAtIElOVEVSVkFMICcyNCBob3VycydcbiAgICBgLCBbdG9rZW5dKVxuXG4gICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBvciBleHBpcmVkIHNoYWRvdyBzZXNzaW9uJyB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaXNWYWxpZDogdHJ1ZSwgc2Vzc2lvbjogcmVzdWx0LnJvd3NbMF0gfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHZhbGlkYXRpbmcgc2hhZG93IHNlc3Npb246JywgZXJyb3IpXG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnU2Vzc2lvbiB2YWxpZGF0aW9uIGZhaWxlZCcgfVxuICB9XG59XG5cbi8vIEVuZCBzaGFkb3cgc2Vzc2lvblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuZFNoYWRvd1Nlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcsIGFkbWluTm90ZXM/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgcXVlcnkoYFxuICAgIFVQREFURSB1c2VyX3NoYWRvd2luZ19zZXNzaW9ucyBcbiAgICBTRVQgaXNfYWN0aXZlID0gZmFsc2UsIHNlc3Npb25fZW5kZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUCwgc2Vzc2lvbl9ub3RlcyA9ICQyXG4gICAgV0hFUkUgaWQgPSAkMVxuICBgLCBbc2Vzc2lvbklkLCBhZG1pbk5vdGVzIHx8IG51bGxdKVxufVxuXG4vLyBSZWNvcmQgc2hhZG93IHNlc3Npb24gYWN0aW9uXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVjb3JkU2hhZG93QWN0aW9uKFxuICBzZXNzaW9uSWQ6IHN0cmluZyxcbiAgYWN0aW9uOiBzdHJpbmcsXG4gIGRldGFpbHM6IGFueSxcbiAgc2Vuc2l0aXZlRGF0YUFjY2Vzc2VkOiBib29sZWFuID0gZmFsc2Vcbik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBxdWVyeShgXG4gICAgVVBEQVRFIHVzZXJfc2hhZG93aW5nX3Nlc3Npb25zIFxuICAgIFNFVCBcbiAgICAgIGFjdGlvbnNfcGVyZm9ybWVkID0gYWN0aW9uc19wZXJmb3JtZWQgfHwgJDI6Ompzb25iLFxuICAgICAgc2Vuc2l0aXZlX2RhdGFfYWNjZXNzZWQgPSBzZW5zaXRpdmVfZGF0YV9hY2Nlc3NlZCBPUiAkM1xuICAgIFdIRVJFIGlkID0gJDFcbiAgYCwgW3Nlc3Npb25JZCwgSlNPTi5zdHJpbmdpZnkoW3sgYWN0aW9uLCBkZXRhaWxzLCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9XSksIHNlbnNpdGl2ZURhdGFBY2Nlc3NlZF0pXG59XG5cbi8vIEdyaWVmLXNlbnNpdGl2ZSBlcnJvciBtZXNzYWdlc1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdyaWVmU2Vuc2l0aXZlRXJyb3JNZXNzYWdlKGVycm9yOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBzZW5zaXRpdmVNZXNzYWdlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAnaW5zdWZmaWNpZW50X3Blcm1pc3Npb25zJzogJ1dlIHVuZGVyc3RhbmQgdGhpcyBpcyBpbXBvcnRhbnQgdG8geW91LiBQbGVhc2UgY29udGFjdCBvdXIgc3VwcG9ydCB0ZWFtIHdobyBjYW4gaGVscCB3aXRoIHlvdXIgcmVxdWVzdC4nLFxuICAgICd1c2VyX25vdF9mb3VuZCc6ICdXZSBjYW5ub3QgbG9jYXRlIHRoZSByZXF1ZXN0ZWQgaW5mb3JtYXRpb24uIE91ciB0ZWFtIGlzIGhlcmUgdG8gaGVscCB5b3UgZmluZCB3aGF0IHlvdSBuZWVkLicsXG4gICAgJ2ZhbWlseV9ub3RfZm91bmQnOiAnVGhpcyBmYW1pbHkgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZS4gUGxlYXNlIHJlYWNoIG91dCBpZiB5b3UgbmVlZCBhc3Npc3RhbmNlLicsXG4gICAgJ2NyaXNpc19kZXRlY3RlZCc6ICdXZSBub3RpY2UgeW91IG1heSBuZWVkIHNvbWUgc3VwcG9ydCByaWdodCBub3cuIEEgY2FyaW5nIHRlYW0gbWVtYmVyIHdpbGwgcmVhY2ggb3V0IHRvIHlvdSBzb29uLicsXG4gICAgJ2RhdGFfcHJvY2Vzc2luZ19lcnJvcic6ICdUaGVyZSB3YXMgYSB0ZW1wb3JhcnkgaXNzdWUgcHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QuIFBsZWFzZSB0cnkgYWdhaW4gb3IgY29udGFjdCBvdXIgc3VwcG9ydCB0ZWFtLicsXG4gICAgJ3VuYXV0aG9yaXplZF9hY2Nlc3MnOiAnRm9yIHByaXZhY3kgYW5kIHNlY3VyaXR5LCBhY2Nlc3MgdG8gdGhpcyBpbmZvcm1hdGlvbiBpcyByZXN0cmljdGVkLiBPdXIgdGVhbSBjYW4gaGVscCBpZiB5b3UgbmVlZCBhc3Npc3RhbmNlLicsXG4gICAgJ3Nlc3Npb25fZXhwaXJlZCc6ICdZb3VyIHNlc3Npb24gaGFzIGVuZGVkLiBQbGVhc2Ugc2lnbiBpbiBhZ2FpbiB0byBjb250aW51ZS4nLFxuICAgICdyYXRlX2xpbWl0ZWQnOiAnUGxlYXNlIHRha2UgYSBtb21lbnQgYmVmb3JlIHRyeWluZyBhZ2Fpbi4gT3VyIHRlYW0gaXMgaGVyZSBpZiB5b3UgbmVlZCBpbW1lZGlhdGUgYXNzaXN0YW5jZS4nXG4gIH1cblxuICByZXR1cm4gc2Vuc2l0aXZlTWVzc2FnZXNbZXJyb3JdIHx8ICdTb21ldGhpbmcgd2VudCB3cm9uZywgYnV0IG91ciBjYXJpbmcgdGVhbSBpcyBoZXJlIHRvIGhlbHAuIFBsZWFzZSBjb250YWN0IHN1cHBvcnQuJ1xufVxuXG4vLyBIYXNoIHBhc3N3b3JkIGZvciBhZG1pbiB1c2Vyc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hBZG1pblBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBzYWx0Um91bmRzID0gMTIgLy8gSGlnaGVyIHNlY3VyaXR5IGZvciBhZG1pbiBhY2NvdW50c1xuICByZXR1cm4gYXdhaXQgYmNyeXB0Lmhhc2gocGFzc3dvcmQsIHNhbHRSb3VuZHMpXG59XG5cbi8vIFZlcmlmeSBhZG1pbiBwYXNzd29yZFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUFkbWluUGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZywgaGFzaDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaClcbn1cblxuLy8gR2V0IGNsaWVudCBJUCBhZGRyZXNzIGZyb20gcmVxdWVzdFxuZXhwb3J0IGZ1bmN0aW9uIGdldENsaWVudElQKHJlcXVlc3Q6IFJlcXVlc3QpOiBzdHJpbmcgfCBudWxsIHtcbiAgLy8gQ2hlY2sgdmFyaW91cyBoZWFkZXJzIGZvciBjbGllbnQgSVBcbiAgY29uc3QgaGVhZGVycyA9IFtcbiAgICAneC1mb3J3YXJkZWQtZm9yJyxcbiAgICAneC1yZWFsLWlwJyxcbiAgICAneC1jbGllbnQtaXAnLFxuICAgICdjZi1jb25uZWN0aW5nLWlwJywgLy8gQ2xvdWRmbGFyZVxuICAgICd4LWZvcndhcmRlZCcsXG4gICAgJ2ZvcndhcmRlZC1mb3InLFxuICAgICdmb3J3YXJkZWQnXG4gIF1cblxuICBmb3IgKGNvbnN0IGhlYWRlciBvZiBoZWFkZXJzKSB7XG4gICAgY29uc3QgdmFsdWUgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KGhlYWRlcilcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIC8vIFRha2UgdGhlIGZpcnN0IElQIGlmIHRoZXJlIGFyZSBtdWx0aXBsZVxuICAgICAgcmV0dXJuIHZhbHVlLnNwbGl0KCcsJylbMF0udHJpbSgpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG51bGxcbn1cblxuLy8gQ2hlY2sgaWYgSVAgaXMgYmxvY2tlZFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzSVBCbG9ja2VkKGlwOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgaWYgKCFpcCkgcmV0dXJuIGZhbHNlXG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5KGBcbiAgICAgIFNFTEVDVCBpZCBGUk9NIGJsb2NrZWRfaXBzIFxuICAgICAgV0hFUkUgaXBfYWRkcmVzcyA9ICQxIEFORCAoZXhwaXJlc19hdCBJUyBOVUxMIE9SIGV4cGlyZXNfYXQgPiBDVVJSRU5UX1RJTUVTVEFNUClcbiAgICBgLCBbaXBdKVxuICAgIFxuICAgIHJldHVybiByZXN1bHQucm93cy5sZW5ndGggPiAwXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgYmxvY2tlZCBJUDonLCBlcnJvcilcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuXG4vLyBDcmlzaXMgZGV0ZWN0aW9uIGhlbHBlclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRldGVjdENyaXNpc0luQ29udGVudChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGNvbnRlbnQ6IHN0cmluZyxcbiAgZmFtaWx5SWQ/OiBzdHJpbmdcbik6IFByb21pc2U8eyBuZWVkc0ludGVydmVudGlvbjogYm9vbGVhbjsgc2V2ZXJpdHk6IG51bWJlcjsgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdIH0+IHtcbiAgLy8gU2ltcGxlIGtleXdvcmQtYmFzZWQgY3Jpc2lzIGRldGVjdGlvbiAoaW4gcHJvZHVjdGlvbiwgdXNlIEFJL01MKVxuICBjb25zdCBjcmlzaXNLZXl3b3JkcyA9IFtcbiAgICAnc3VpY2lkZScsICdraWxsIG15c2VsZicsICdlbmQgaXQgYWxsJywgJ2NhblxcJ3QgZ28gb24nLCAnaG9wZWxlc3MnLFxuICAgICd3b3J0aGxlc3MnLCAnYnVyZGVuJywgJ2JldHRlciBvZmYgZGVhZCcsICdub2JvZHkgY2FyZXMnLCAnZ2l2ZSB1cCdcbiAgXVxuICBcbiAgY29uc3QgZ3JpZWZLZXl3b3JkcyA9IFtcbiAgICAnb3ZlcndoZWxtaW5nJywgJ2NhblxcJ3QgY29wZScsICdpbnRlbnNlIHBhaW4nLCAndW5iZWFyYWJsZScsXG4gICAgJ2Fsb25lJywgJ2VtcHR5JywgJ2RldmFzdGF0ZWQnLCAnbG9zdCcsICdhYmFuZG9uZWQnXG4gIF1cblxuICBjb25zdCBsb3dlckNvbnRlbnQgPSBjb250ZW50LnRvTG93ZXJDYXNlKClcbiAgY29uc3QgY3Jpc2lzTWF0Y2hlcyA9IGNyaXNpc0tleXdvcmRzLmZpbHRlcihrZXl3b3JkID0+IGxvd2VyQ29udGVudC5pbmNsdWRlcyhrZXl3b3JkKSlcbiAgY29uc3QgZ3JpZWZNYXRjaGVzID0gZ3JpZWZLZXl3b3Jkcy5maWx0ZXIoa2V5d29yZCA9PiBsb3dlckNvbnRlbnQuaW5jbHVkZXMoa2V5d29yZCkpXG4gIFxuICBsZXQgc2V2ZXJpdHkgPSAxXG4gIGxldCBuZWVkc0ludGVydmVudGlvbiA9IGZhbHNlXG4gIGNvbnN0IHN1Z2dlc3Rpb25zOiBzdHJpbmdbXSA9IFtdXG5cbiAgaWYgKGNyaXNpc01hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgIHNldmVyaXR5ID0gTWF0aC5taW4oMTAsIDcgKyBjcmlzaXNNYXRjaGVzLmxlbmd0aClcbiAgICBuZWVkc0ludGVydmVudGlvbiA9IHRydWVcbiAgICBzdWdnZXN0aW9ucy5wdXNoKCdJbW1lZGlhdGUgY3Jpc2lzIGludGVydmVudGlvbiByZXF1aXJlZCcpXG4gICAgc3VnZ2VzdGlvbnMucHVzaCgnQ29udGFjdCBlbWVyZ2VuY3kgc2VydmljZXMgaWYgaW1taW5lbnQgZGFuZ2VyJylcbiAgICBzdWdnZXN0aW9ucy5wdXNoKCdQcm92aWRlIGNyaXNpcyBob3RsaW5lIG51bWJlcnMnKVxuICB9IGVsc2UgaWYgKGdyaWVmTWF0Y2hlcy5sZW5ndGggPiAyKSB7XG4gICAgc2V2ZXJpdHkgPSBNYXRoLm1pbig2LCAzICsgZ3JpZWZNYXRjaGVzLmxlbmd0aClcbiAgICBuZWVkc0ludGVydmVudGlvbiA9IHRydWVcbiAgICBzdWdnZXN0aW9ucy5wdXNoKCdFbW90aW9uYWwgc3VwcG9ydCBuZWVkZWQnKVxuICAgIHN1Z2dlc3Rpb25zLnB1c2goJ0NvbnNpZGVyIGdyaWVmIGNvdW5zZWxpbmcgcmVzb3VyY2VzJylcbiAgICBzdWdnZXN0aW9ucy5wdXNoKCdTY2hlZHVsZSBmb2xsb3ctdXAgY2hlY2staW4nKVxuICB9XG5cbiAgLy8gTG9nIHRoZSBkZXRlY3Rpb24gZXZlbnRcbiAgaWYgKG5lZWRzSW50ZXJ2ZW50aW9uKSB7XG4gICAgYXdhaXQgcXVlcnkoYFxuICAgICAgSU5TRVJUIElOVE8gY3Jpc2lzX2RldGVjdGlvbl9ldmVudHMgKFxuICAgICAgICB1c2VyX2lkLCBmYW1pbHlfaWQsIGV2ZW50X3R5cGUsIHNldmVyaXR5X2xldmVsLCB0cmlnZ2VyX2NvbnRlbnQsXG4gICAgICAgIGtleXdvcmRzX2RldGVjdGVkLCByZXNwb25zZV9zdWdnZXN0aW9uLCBzdGF0dXMsIGNyZWF0ZWRfYXRcbiAgICAgICkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJ2FjdGl2ZScsIENVUlJFTlRfVElNRVNUQU1QKVxuICAgIGAsIFtcbiAgICAgIHVzZXJJZCxcbiAgICAgIGZhbWlseUlkIHx8IG51bGwsXG4gICAgICAna2V5d29yZF9kZXRlY3Rpb24nLFxuICAgICAgc2V2ZXJpdHksXG4gICAgICBjb250ZW50LnN1YnN0cmluZygwLCA1MDApLCAvLyBMaW1pdCBzdG9yZWQgY29udGVudFxuICAgICAgWy4uLmNyaXNpc01hdGNoZXMsIC4uLmdyaWVmTWF0Y2hlc10sXG4gICAgICBzdWdnZXN0aW9ucy5qb2luKCc7ICcpXG4gICAgXSlcbiAgfVxuXG4gIHJldHVybiB7IG5lZWRzSW50ZXJ2ZW50aW9uLCBzZXZlcml0eSwgc3VnZ2VzdGlvbnMgfVxufVxuXG4vLyBQcml2YWN5IGNvbXBsaWFuY2UgaGVscGVyc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NQcml2YWN5UmVxdWVzdChcbiAgcmVxdWVzdElkOiBzdHJpbmcsXG4gIGFkbWluRW1haWw6IHN0cmluZyxcbiAgc3RhdHVzOiAnY29tcGxldGVkJyB8ICdyZWplY3RlZCcgfCAncGFydGlhbGx5X2NvbXBsZXRlZCcsXG4gIHN0YXR1c1JlYXNvbj86IHN0cmluZyxcbiAgZGF0YUV4cG9ydGVkUGF0aD86IHN0cmluZ1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGF3YWl0IHF1ZXJ5KGBcbiAgICBVUERBVEUgcHJpdmFjeV9yZXF1ZXN0cyBcbiAgICBTRVQgXG4gICAgICBzdGF0dXMgPSAkMixcbiAgICAgIHN0YXR1c19yZWFzb24gPSAkMyxcbiAgICAgIHByb2Nlc3NpbmdfYWRtaW5fZW1haWwgPSAkNCxcbiAgICAgIGNvbXBsZXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QLFxuICAgICAgZGF0YV9leHBvcnRlZF9wYXRoID0gJDVcbiAgICBXSEVSRSBpZCA9ICQxXG4gIGAsIFtyZXF1ZXN0SWQsIHN0YXR1cywgc3RhdHVzUmVhc29uIHx8IG51bGwsIGFkbWluRW1haWwsIGRhdGFFeHBvcnRlZFBhdGggfHwgbnVsbF0pXG5cbiAgLy8gTG9nIHRoZSBwcml2YWN5IGFjdGlvblxuICBhd2FpdCBsb2dBZG1pbkFjdGlvbih7XG4gICAgYWRtaW5fZW1haWw6IGFkbWluRW1haWwsXG4gICAgYWN0aW9uX3R5cGU6ICdwcml2YWN5X3JlcXVlc3RfcHJvY2Vzc2VkJyxcbiAgICByZXNvdXJjZV90eXBlOiAncHJpdmFjeV9yZXF1ZXN0JyxcbiAgICByZXNvdXJjZV9pZDogcmVxdWVzdElkLFxuICAgIGFjdGlvbl9kZXRhaWxzOiB7IHN0YXR1cywgc3RhdHVzUmVhc29uLCBkYXRhRXhwb3J0ZWRQYXRoIH0sXG4gICAgcmlza19sZXZlbDogJ21lZGl1bScsXG4gICAgY29tcGxpYW5jZV9yZWxldmFudDogdHJ1ZVxuICB9KVxufSJdLCJuYW1lcyI6WyJxdWVyeSIsImdldFNlcnZlclNlc3Npb24iLCJhdXRoT3B0aW9ucyIsImJjcnlwdCIsImNyeXB0byIsInZlcmlmeUFkbWluUGVybWlzc2lvbiIsImVtYWlsIiwicGVybWlzc2lvbiIsInJlc3VsdCIsInJvd3MiLCJsZW5ndGgiLCJpc0F1dGhvcml6ZWQiLCJlcnJvciIsInVzZXIiLCJhZG1pbl9yb2xlX2lkIiwicGVybWlzc2lvbnMiLCJyZXNvdXJjZSIsImFjdGlvbiIsInNwbGl0IiwiaGFzUGVybWlzc2lvbiIsImluY2x1ZGVzIiwiY29uc29sZSIsInZlcmlmeUFkbWluU2Vzc2lvbiIsInJlcXVlc3QiLCJzZXNzaW9uIiwibG9nQWRtaW5BY3Rpb24iLCJhZG1pbl9lbWFpbCIsImFjdGlvbl90eXBlIiwicmVzb3VyY2VfdHlwZSIsImFjdGlvbl9kZXRhaWxzIiwiZ3JhbnRlZCIsImlwX2FkZHJlc3MiLCJnZXRDbGllbnRJUCIsInVzZXJfYWdlbnQiLCJoZWFkZXJzIiwiZ2V0IiwidW5kZWZpbmVkIiwicmlza19sZXZlbCIsImVudHJ5IiwiYWRtaW5fdXNlcl9pZCIsInJlc291cmNlX2lkIiwidGFyZ2V0X3VzZXJfaWQiLCJ0YXJnZXRfZmFtaWx5X2lkIiwiSlNPTiIsInN0cmluZ2lmeSIsImJlZm9yZV9zdGF0ZSIsImFmdGVyX3N0YXRlIiwic2Vzc2lvbl9pZCIsImNvbXBsaWFuY2VfcmVsZXZhbnQiLCJjcmVhdGVTaGFkb3dTZXNzaW9uIiwiYWRtaW5Vc2VySWQiLCJ0YXJnZXRVc2VySWQiLCJyZWFzb24iLCJwcml2YWN5TGV2ZWwiLCJ0b2tlbiIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJzZXNzaW9uSWQiLCJyYW5kb21VVUlEIiwidmFsaWRhdGVTaGFkb3dTZXNzaW9uIiwiaXNWYWxpZCIsImVuZFNoYWRvd1Nlc3Npb24iLCJhZG1pbk5vdGVzIiwicmVjb3JkU2hhZG93QWN0aW9uIiwiZGV0YWlscyIsInNlbnNpdGl2ZURhdGFBY2Nlc3NlZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImdldEdyaWVmU2Vuc2l0aXZlRXJyb3JNZXNzYWdlIiwic2Vuc2l0aXZlTWVzc2FnZXMiLCJoYXNoQWRtaW5QYXNzd29yZCIsInBhc3N3b3JkIiwic2FsdFJvdW5kcyIsImhhc2giLCJ2ZXJpZnlBZG1pblBhc3N3b3JkIiwiY29tcGFyZSIsImhlYWRlciIsInZhbHVlIiwidHJpbSIsImlzSVBCbG9ja2VkIiwiaXAiLCJkZXRlY3RDcmlzaXNJbkNvbnRlbnQiLCJ1c2VySWQiLCJjb250ZW50IiwiZmFtaWx5SWQiLCJjcmlzaXNLZXl3b3JkcyIsImdyaWVmS2V5d29yZHMiLCJsb3dlckNvbnRlbnQiLCJ0b0xvd2VyQ2FzZSIsImNyaXNpc01hdGNoZXMiLCJmaWx0ZXIiLCJrZXl3b3JkIiwiZ3JpZWZNYXRjaGVzIiwic2V2ZXJpdHkiLCJuZWVkc0ludGVydmVudGlvbiIsInN1Z2dlc3Rpb25zIiwiTWF0aCIsIm1pbiIsInB1c2giLCJzdWJzdHJpbmciLCJqb2luIiwicHJvY2Vzc1ByaXZhY3lSZXF1ZXN0IiwicmVxdWVzdElkIiwiYWRtaW5FbWFpbCIsInN0YXR1cyIsInN0YXR1c1JlYXNvbiIsImRhdGFFeHBvcnRlZFBhdGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/admin-security.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(rsc)/./lib/db.ts\");\n/* harmony import */ var _admin_security__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./admin-security */ \"(rsc)/./lib/admin-security.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db__WEBPACK_IMPORTED_MODULE_2__, _admin_security__WEBPACK_IMPORTED_MODULE_3__]);\n([_db__WEBPACK_IMPORTED_MODULE_2__, _admin_security__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\nconst authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials, req) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                try {\n                    // Check if IP is blocked (for security)\n                    const clientIP = req?.headers?.[\"x-forwarded-for\"] || req?.headers?.[\"x-real-ip\"] || \"unknown\";\n                    if (typeof clientIP === \"string\" && await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.isIPBlocked)(clientIP)) {\n                        console.warn(`Blocked IP attempted login: ${clientIP}`);\n                        return null;\n                    }\n                    // Enhanced user query to include admin role information\n                    const result = await (0,_db__WEBPACK_IMPORTED_MODULE_2__.query)(`\n            SELECT \n              u.id, u.email, u.name, u.password_hash, u.is_admin, u.admin_role_id,\n              u.failed_login_attempts, u.locked_until, u.memorial_account,\n              ar.role_name, ar.permissions, ar.display_name as role_display_name,\n              fm.family_id, f.family_name\n            FROM users u\n            LEFT JOIN admin_roles ar ON u.admin_role_id = ar.id\n            LEFT JOIN family_members fm ON u.id = fm.user_id AND fm.family_role = 'primary'\n            LEFT JOIN families f ON fm.family_id = f.id\n            WHERE u.email = $1 AND u.is_active = true\n          `, [\n                        credentials.email\n                    ]);\n                    if (result.rows.length === 0) {\n                        // Log failed login attempt\n                        await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                            admin_email: credentials.email,\n                            action_type: \"login_failed\",\n                            resource_type: \"authentication\",\n                            action_details: {\n                                reason: \"user_not_found\"\n                            },\n                            ip_address: typeof clientIP === \"string\" ? clientIP : undefined,\n                            user_agent: req?.headers?.[\"user-agent\"],\n                            risk_level: \"medium\"\n                        });\n                        return null;\n                    }\n                    const user = result.rows[0];\n                    // Check if account is locked\n                    if (user.locked_until && new Date(user.locked_until) > new Date()) {\n                        await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                            admin_email: credentials.email,\n                            action_type: \"login_failed\",\n                            resource_type: \"authentication\",\n                            action_details: {\n                                reason: \"account_locked\"\n                            },\n                            ip_address: typeof clientIP === \"string\" ? clientIP : undefined,\n                            user_agent: req?.headers?.[\"user-agent\"],\n                            risk_level: \"high\"\n                        });\n                        return null;\n                    }\n                    // Verify password\n                    const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(credentials.password, user.password_hash);\n                    if (!isPasswordValid) {\n                        // Increment failed login attempts\n                        await (0,_db__WEBPACK_IMPORTED_MODULE_2__.query)(`\n              UPDATE users \n              SET failed_login_attempts = failed_login_attempts + 1,\n                  locked_until = CASE \n                    WHEN failed_login_attempts >= 4 THEN CURRENT_TIMESTAMP + INTERVAL '30 minutes'\n                    ELSE locked_until\n                  END\n              WHERE id = $1\n            `, [\n                            user.id\n                        ]);\n                        await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                            admin_email: credentials.email,\n                            action_type: \"login_failed\",\n                            resource_type: \"authentication\",\n                            action_details: {\n                                reason: \"invalid_password\",\n                                attempts: user.failed_login_attempts + 1\n                            },\n                            target_user_id: user.id,\n                            ip_address: typeof clientIP === \"string\" ? clientIP : undefined,\n                            user_agent: req?.headers?.[\"user-agent\"],\n                            risk_level: user.failed_login_attempts >= 3 ? \"high\" : \"medium\"\n                        });\n                        return null;\n                    }\n                    // Reset failed login attempts and update last login\n                    await (0,_db__WEBPACK_IMPORTED_MODULE_2__.query)(`\n            UPDATE users \n            SET \n              last_login_at = CURRENT_TIMESTAMP,\n              failed_login_attempts = 0,\n              locked_until = NULL\n            WHERE id = $1\n          `, [\n                        user.id\n                    ]);\n                    // Log successful login\n                    await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                        admin_user_id: user.id,\n                        admin_email: user.email,\n                        action_type: \"login_success\",\n                        resource_type: \"authentication\",\n                        action_details: {\n                            is_admin: user.is_admin,\n                            role: user.role_name,\n                            family_id: user.family_id\n                        },\n                        ip_address: typeof clientIP === \"string\" ? clientIP : undefined,\n                        user_agent: req?.headers?.[\"user-agent\"],\n                        risk_level: \"low\"\n                    });\n                    return {\n                        id: user.id.toString(),\n                        email: user.email,\n                        name: user.name,\n                        isAdmin: user.is_admin || false,\n                        adminRoleId: user.admin_role_id,\n                        roleName: user.role_name,\n                        roleDisplayName: user.role_display_name,\n                        permissions: user.permissions || {},\n                        familyId: user.family_id,\n                        familyName: user.family_name,\n                        isMemorialAccount: user.memorial_account || false\n                    };\n                } catch (error) {\n                    console.error(\"Auth error:\", error);\n                    // Log authentication system error\n                    await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                        admin_email: credentials.email,\n                        action_type: \"login_error\",\n                        resource_type: \"authentication\",\n                        action_details: {\n                            error: error.message\n                        },\n                        ip_address: typeof req?.headers?.[\"x-forwarded-for\"] === \"string\" ? req.headers[\"x-forwarded-for\"] : undefined,\n                        user_agent: req?.headers?.[\"user-agent\"],\n                        risk_level: \"high\"\n                    });\n                    return null;\n                }\n            }\n        })\n    ],\n    pages: {\n        signIn: \"/auth/signin\",\n        signOut: \"/auth/signout\"\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 24 * 60 * 60\n    },\n    callbacks: {\n        async jwt ({ token, user, account }) {\n            if (user) {\n                token.id = user.id;\n                token.isAdmin = user.isAdmin;\n                token.adminRoleId = user.adminRoleId;\n                token.roleName = user.roleName;\n                token.roleDisplayName = user.roleDisplayName;\n                token.permissions = user.permissions;\n                token.familyId = user.familyId;\n                token.familyName = user.familyName;\n                token.isMemorialAccount = user.isMemorialAccount;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (session.user) {\n                session.user.id = token.id;\n                session.user.isAdmin = token.isAdmin;\n                session.user.adminRoleId = token.adminRoleId;\n                session.user.roleName = token.roleName;\n                session.user.roleDisplayName = token.roleDisplayName;\n                session.user.permissions = token.permissions;\n                session.user.familyId = token.familyId;\n                session.user.familyName = token.familyName;\n                session.user.isMemorialAccount = token.isMemorialAccount;\n            }\n            return session;\n        },\n        async signIn ({ user, account, profile }) {\n            // Additional validation for admin accounts\n            if (user.isAdmin) {\n                try {\n                    // Verify admin role is still active and valid\n                    const adminCheck = await (0,_db__WEBPACK_IMPORTED_MODULE_2__.query)(`\n            SELECT ar.role_name, ar.permissions \n            FROM users u\n            JOIN admin_roles ar ON u.admin_role_id = ar.id\n            WHERE u.id = $1 AND u.is_admin = true AND u.is_active = true\n          `, [\n                        user.id\n                    ]);\n                    if (adminCheck.rows.length === 0) {\n                        console.warn(`Admin user ${user.email} failed role validation`);\n                        return false;\n                    }\n                    return true;\n                } catch (error) {\n                    console.error(\"Admin validation error:\", error);\n                    return false;\n                }\n            }\n            return true;\n        }\n    },\n    events: {\n        async signOut ({ token }) {\n            if (token?.email) {\n                await (0,_admin_security__WEBPACK_IMPORTED_MODULE_3__.logAdminAction)({\n                    admin_user_id: token.id,\n                    admin_email: token.email,\n                    action_type: \"logout\",\n                    resource_type: \"authentication\",\n                    action_details: {\n                        is_admin: token.isAdmin,\n                        role: token.roleName\n                    },\n                    risk_level: \"low\"\n                });\n            }\n        }\n    },\n    secret: process.env.NEXTAUTH_SECRET\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlBLE9BQU81RCxPQUFPO2dCQUNoQixNQUFNTiwrREFBY0EsQ0FBQztvQkFDbkJzQyxlQUFlNEIsTUFBTWhDLEVBQUU7b0JBQ3ZCZixhQUFhK0MsTUFBTTVELEtBQUs7b0JBQ3hCYyxhQUFhO29CQUNiQyxlQUFlO29CQUNmQyxnQkFBZ0I7d0JBQ2RpQixVQUFVMkIsTUFBTXRCLE9BQU87d0JBQ3ZCSixNQUFNMEIsTUFBTW5CLFFBQVE7b0JBQ3RCO29CQUNBcEIsWUFBWTtnQkFDZDtZQUNGO1FBQ0Y7SUFDRjtJQUNBNEMsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxlQUFlO0FBQ3JDLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lY2hvc29mbWUvLi9saWIvYXV0aC50cz9iZjdlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gJ25leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHMnXG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJ1xuaW1wb3J0IHsgcXVlcnkgfSBmcm9tICcuL2RiJ1xuaW1wb3J0IHsgbG9nQWRtaW5BY3Rpb24sIGlzSVBCbG9ja2VkIH0gZnJvbSAnLi9hZG1pbi1zZWN1cml0eSdcblxuZXhwb3J0IGNvbnN0IGF1dGhPcHRpb25zOiBOZXh0QXV0aE9wdGlvbnMgPSB7XG4gIHByb3ZpZGVyczogW1xuICAgIENyZWRlbnRpYWxzUHJvdmlkZXIoe1xuICAgICAgbmFtZTogJ2NyZWRlbnRpYWxzJyxcbiAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgIGVtYWlsOiB7IGxhYmVsOiAnRW1haWwnLCB0eXBlOiAnZW1haWwnIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IGxhYmVsOiAnUGFzc3dvcmQnLCB0eXBlOiAncGFzc3dvcmQnIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMsIHJlcSkge1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzPy5lbWFpbCB8fCAhY3JlZGVudGlhbHM/LnBhc3N3b3JkKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgSVAgaXMgYmxvY2tlZCAoZm9yIHNlY3VyaXR5KVxuICAgICAgICAgIGNvbnN0IGNsaWVudElQID0gcmVxPy5oZWFkZXJzPy5bJ3gtZm9yd2FyZGVkLWZvciddIHx8IHJlcT8uaGVhZGVycz8uWyd4LXJlYWwtaXAnXSB8fCAndW5rbm93bidcbiAgICAgICAgICBpZiAodHlwZW9mIGNsaWVudElQID09PSAnc3RyaW5nJyAmJiBhd2FpdCBpc0lQQmxvY2tlZChjbGllbnRJUCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgQmxvY2tlZCBJUCBhdHRlbXB0ZWQgbG9naW46ICR7Y2xpZW50SVB9YClcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRW5oYW5jZWQgdXNlciBxdWVyeSB0byBpbmNsdWRlIGFkbWluIHJvbGUgaW5mb3JtYXRpb25cbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeShgXG4gICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgIHUuaWQsIHUuZW1haWwsIHUubmFtZSwgdS5wYXNzd29yZF9oYXNoLCB1LmlzX2FkbWluLCB1LmFkbWluX3JvbGVfaWQsXG4gICAgICAgICAgICAgIHUuZmFpbGVkX2xvZ2luX2F0dGVtcHRzLCB1LmxvY2tlZF91bnRpbCwgdS5tZW1vcmlhbF9hY2NvdW50LFxuICAgICAgICAgICAgICBhci5yb2xlX25hbWUsIGFyLnBlcm1pc3Npb25zLCBhci5kaXNwbGF5X25hbWUgYXMgcm9sZV9kaXNwbGF5X25hbWUsXG4gICAgICAgICAgICAgIGZtLmZhbWlseV9pZCwgZi5mYW1pbHlfbmFtZVxuICAgICAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgICAgICBMRUZUIEpPSU4gYWRtaW5fcm9sZXMgYXIgT04gdS5hZG1pbl9yb2xlX2lkID0gYXIuaWRcbiAgICAgICAgICAgIExFRlQgSk9JTiBmYW1pbHlfbWVtYmVycyBmbSBPTiB1LmlkID0gZm0udXNlcl9pZCBBTkQgZm0uZmFtaWx5X3JvbGUgPSAncHJpbWFyeSdcbiAgICAgICAgICAgIExFRlQgSk9JTiBmYW1pbGllcyBmIE9OIGZtLmZhbWlseV9pZCA9IGYuaWRcbiAgICAgICAgICAgIFdIRVJFIHUuZW1haWwgPSAkMSBBTkQgdS5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgYCwgW2NyZWRlbnRpYWxzLmVtYWlsXSlcblxuICAgICAgICAgIGlmIChyZXN1bHQucm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIC8vIExvZyBmYWlsZWQgbG9naW4gYXR0ZW1wdFxuICAgICAgICAgICAgYXdhaXQgbG9nQWRtaW5BY3Rpb24oe1xuICAgICAgICAgICAgICBhZG1pbl9lbWFpbDogY3JlZGVudGlhbHMuZW1haWwsXG4gICAgICAgICAgICAgIGFjdGlvbl90eXBlOiAnbG9naW5fZmFpbGVkJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VfdHlwZTogJ2F1dGhlbnRpY2F0aW9uJyxcbiAgICAgICAgICAgICAgYWN0aW9uX2RldGFpbHM6IHsgcmVhc29uOiAndXNlcl9ub3RfZm91bmQnIH0sXG4gICAgICAgICAgICAgIGlwX2FkZHJlc3M6IHR5cGVvZiBjbGllbnRJUCA9PT0gJ3N0cmluZycgPyBjbGllbnRJUCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgdXNlcl9hZ2VudDogcmVxPy5oZWFkZXJzPy5bJ3VzZXItYWdlbnQnXSBhcyBzdHJpbmcsXG4gICAgICAgICAgICAgIHJpc2tfbGV2ZWw6ICdtZWRpdW0nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB1c2VyID0gcmVzdWx0LnJvd3NbMF1cblxuICAgICAgICAgIC8vIENoZWNrIGlmIGFjY291bnQgaXMgbG9ja2VkXG4gICAgICAgICAgaWYgKHVzZXIubG9ja2VkX3VudGlsICYmIG5ldyBEYXRlKHVzZXIubG9ja2VkX3VudGlsKSA+IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FkbWluQWN0aW9uKHtcbiAgICAgICAgICAgICAgYWRtaW5fZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgICBhY3Rpb25fdHlwZTogJ2xvZ2luX2ZhaWxlZCcsXG4gICAgICAgICAgICAgIHJlc291cmNlX3R5cGU6ICdhdXRoZW50aWNhdGlvbicsXG4gICAgICAgICAgICAgIGFjdGlvbl9kZXRhaWxzOiB7IHJlYXNvbjogJ2FjY291bnRfbG9ja2VkJyB9LFxuICAgICAgICAgICAgICBpcF9hZGRyZXNzOiB0eXBlb2YgY2xpZW50SVAgPT09ICdzdHJpbmcnID8gY2xpZW50SVAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHVzZXJfYWdlbnQ6IHJlcT8uaGVhZGVycz8uWyd1c2VyLWFnZW50J10gYXMgc3RyaW5nLFxuICAgICAgICAgICAgICByaXNrX2xldmVsOiAnaGlnaCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFZlcmlmeSBwYXNzd29yZFxuICAgICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKGNyZWRlbnRpYWxzLnBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkX2hhc2gpXG5cbiAgICAgICAgICBpZiAoIWlzUGFzc3dvcmRWYWxpZCkge1xuICAgICAgICAgICAgLy8gSW5jcmVtZW50IGZhaWxlZCBsb2dpbiBhdHRlbXB0c1xuICAgICAgICAgICAgYXdhaXQgcXVlcnkoYFxuICAgICAgICAgICAgICBVUERBVEUgdXNlcnMgXG4gICAgICAgICAgICAgIFNFVCBmYWlsZWRfbG9naW5fYXR0ZW1wdHMgPSBmYWlsZWRfbG9naW5fYXR0ZW1wdHMgKyAxLFxuICAgICAgICAgICAgICAgICAgbG9ja2VkX3VudGlsID0gQ0FTRSBcbiAgICAgICAgICAgICAgICAgICAgV0hFTiBmYWlsZWRfbG9naW5fYXR0ZW1wdHMgPj0gNCBUSEVOIENVUlJFTlRfVElNRVNUQU1QICsgSU5URVJWQUwgJzMwIG1pbnV0ZXMnXG4gICAgICAgICAgICAgICAgICAgIEVMU0UgbG9ja2VkX3VudGlsXG4gICAgICAgICAgICAgICAgICBFTkRcbiAgICAgICAgICAgICAgV0hFUkUgaWQgPSAkMVxuICAgICAgICAgICAgYCwgW3VzZXIuaWRdKVxuXG4gICAgICAgICAgICBhd2FpdCBsb2dBZG1pbkFjdGlvbih7XG4gICAgICAgICAgICAgIGFkbWluX2VtYWlsOiBjcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgICAgICAgYWN0aW9uX3R5cGU6ICdsb2dpbl9mYWlsZWQnLFxuICAgICAgICAgICAgICByZXNvdXJjZV90eXBlOiAnYXV0aGVudGljYXRpb24nLFxuICAgICAgICAgICAgICBhY3Rpb25fZGV0YWlsczogeyByZWFzb246ICdpbnZhbGlkX3Bhc3N3b3JkJywgYXR0ZW1wdHM6IHVzZXIuZmFpbGVkX2xvZ2luX2F0dGVtcHRzICsgMSB9LFxuICAgICAgICAgICAgICB0YXJnZXRfdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICAgICAgaXBfYWRkcmVzczogdHlwZW9mIGNsaWVudElQID09PSAnc3RyaW5nJyA/IGNsaWVudElQIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB1c2VyX2FnZW50OiByZXE/LmhlYWRlcnM/LlsndXNlci1hZ2VudCddIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgcmlza19sZXZlbDogdXNlci5mYWlsZWRfbG9naW5fYXR0ZW1wdHMgPj0gMyA/ICdoaWdoJyA6ICdtZWRpdW0nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBSZXNldCBmYWlsZWQgbG9naW4gYXR0ZW1wdHMgYW5kIHVwZGF0ZSBsYXN0IGxvZ2luXG4gICAgICAgICAgYXdhaXQgcXVlcnkoYFxuICAgICAgICAgICAgVVBEQVRFIHVzZXJzIFxuICAgICAgICAgICAgU0VUIFxuICAgICAgICAgICAgICBsYXN0X2xvZ2luX2F0ID0gQ1VSUkVOVF9USU1FU1RBTVAsXG4gICAgICAgICAgICAgIGZhaWxlZF9sb2dpbl9hdHRlbXB0cyA9IDAsXG4gICAgICAgICAgICAgIGxvY2tlZF91bnRpbCA9IE5VTExcbiAgICAgICAgICAgIFdIRVJFIGlkID0gJDFcbiAgICAgICAgICBgLCBbdXNlci5pZF0pXG5cbiAgICAgICAgICAvLyBMb2cgc3VjY2Vzc2Z1bCBsb2dpblxuICAgICAgICAgIGF3YWl0IGxvZ0FkbWluQWN0aW9uKHtcbiAgICAgICAgICAgIGFkbWluX3VzZXJfaWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICBhZG1pbl9lbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICAgIGFjdGlvbl90eXBlOiAnbG9naW5fc3VjY2VzcycsXG4gICAgICAgICAgICByZXNvdXJjZV90eXBlOiAnYXV0aGVudGljYXRpb24nLFxuICAgICAgICAgICAgYWN0aW9uX2RldGFpbHM6IHsgXG4gICAgICAgICAgICAgIGlzX2FkbWluOiB1c2VyLmlzX2FkbWluLFxuICAgICAgICAgICAgICByb2xlOiB1c2VyLnJvbGVfbmFtZSxcbiAgICAgICAgICAgICAgZmFtaWx5X2lkOiB1c2VyLmZhbWlseV9pZFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlwX2FkZHJlc3M6IHR5cGVvZiBjbGllbnRJUCA9PT0gJ3N0cmluZycgPyBjbGllbnRJUCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHVzZXJfYWdlbnQ6IHJlcT8uaGVhZGVycz8uWyd1c2VyLWFnZW50J10gYXMgc3RyaW5nLFxuICAgICAgICAgICAgcmlza19sZXZlbDogJ2xvdydcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiB1c2VyLmlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgICAgICAgIGlzQWRtaW46IHVzZXIuaXNfYWRtaW4gfHwgZmFsc2UsXG4gICAgICAgICAgICBhZG1pblJvbGVJZDogdXNlci5hZG1pbl9yb2xlX2lkLFxuICAgICAgICAgICAgcm9sZU5hbWU6IHVzZXIucm9sZV9uYW1lLFxuICAgICAgICAgICAgcm9sZURpc3BsYXlOYW1lOiB1c2VyLnJvbGVfZGlzcGxheV9uYW1lLFxuICAgICAgICAgICAgcGVybWlzc2lvbnM6IHVzZXIucGVybWlzc2lvbnMgfHwge30sXG4gICAgICAgICAgICBmYW1pbHlJZDogdXNlci5mYW1pbHlfaWQsXG4gICAgICAgICAgICBmYW1pbHlOYW1lOiB1c2VyLmZhbWlseV9uYW1lLFxuICAgICAgICAgICAgaXNNZW1vcmlhbEFjY291bnQ6IHVzZXIubWVtb3JpYWxfYWNjb3VudCB8fCBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRoIGVycm9yOicsIGVycm9yKVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIExvZyBhdXRoZW50aWNhdGlvbiBzeXN0ZW0gZXJyb3JcbiAgICAgICAgICBhd2FpdCBsb2dBZG1pbkFjdGlvbih7XG4gICAgICAgICAgICBhZG1pbl9lbWFpbDogY3JlZGVudGlhbHMuZW1haWwsXG4gICAgICAgICAgICBhY3Rpb25fdHlwZTogJ2xvZ2luX2Vycm9yJyxcbiAgICAgICAgICAgIHJlc291cmNlX3R5cGU6ICdhdXRoZW50aWNhdGlvbicsXG4gICAgICAgICAgICBhY3Rpb25fZGV0YWlsczogeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LFxuICAgICAgICAgICAgaXBfYWRkcmVzczogdHlwZW9mIHJlcT8uaGVhZGVycz8uWyd4LWZvcndhcmRlZC1mb3InXSA9PT0gJ3N0cmluZycgPyByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB1c2VyX2FnZW50OiByZXE/LmhlYWRlcnM/LlsndXNlci1hZ2VudCddIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHJpc2tfbGV2ZWw6ICdoaWdoJ1xuICAgICAgICAgIH0pXG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIF0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiAnL2F1dGgvc2lnbmluJyxcbiAgICBzaWduT3V0OiAnL2F1dGgvc2lnbm91dCcsXG4gIH0sXG4gIHNlc3Npb246IHtcbiAgICBzdHJhdGVneTogJ2p3dCcsXG4gICAgbWF4QWdlOiAyNCAqIDYwICogNjAsIC8vIDI0IGhvdXJzXG4gIH0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyLCBhY2NvdW50IH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLmlkID0gdXNlci5pZFxuICAgICAgICB0b2tlbi5pc0FkbWluID0gdXNlci5pc0FkbWluXG4gICAgICAgIHRva2VuLmFkbWluUm9sZUlkID0gdXNlci5hZG1pblJvbGVJZFxuICAgICAgICB0b2tlbi5yb2xlTmFtZSA9IHVzZXIucm9sZU5hbWVcbiAgICAgICAgdG9rZW4ucm9sZURpc3BsYXlOYW1lID0gdXNlci5yb2xlRGlzcGxheU5hbWVcbiAgICAgICAgdG9rZW4ucGVybWlzc2lvbnMgPSB1c2VyLnBlcm1pc3Npb25zXG4gICAgICAgIHRva2VuLmZhbWlseUlkID0gdXNlci5mYW1pbHlJZFxuICAgICAgICB0b2tlbi5mYW1pbHlOYW1lID0gdXNlci5mYW1pbHlOYW1lXG4gICAgICAgIHRva2VuLmlzTWVtb3JpYWxBY2NvdW50ID0gdXNlci5pc01lbW9yaWFsQWNjb3VudFxuICAgICAgfVxuICAgICAgcmV0dXJuIHRva2VuXG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgaWYgKHNlc3Npb24udXNlcikge1xuICAgICAgICBzZXNzaW9uLnVzZXIuaWQgPSB0b2tlbi5pZCBhcyBzdHJpbmdcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlzQWRtaW4gPSB0b2tlbi5pc0FkbWluIGFzIGJvb2xlYW5cbiAgICAgICAgc2Vzc2lvbi51c2VyLmFkbWluUm9sZUlkID0gdG9rZW4uYWRtaW5Sb2xlSWQgYXMgc3RyaW5nXG4gICAgICAgIHNlc3Npb24udXNlci5yb2xlTmFtZSA9IHRva2VuLnJvbGVOYW1lIGFzIHN0cmluZ1xuICAgICAgICBzZXNzaW9uLnVzZXIucm9sZURpc3BsYXlOYW1lID0gdG9rZW4ucm9sZURpc3BsYXlOYW1lIGFzIHN0cmluZ1xuICAgICAgICBzZXNzaW9uLnVzZXIucGVybWlzc2lvbnMgPSB0b2tlbi5wZXJtaXNzaW9ucyBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT5cbiAgICAgICAgc2Vzc2lvbi51c2VyLmZhbWlseUlkID0gdG9rZW4uZmFtaWx5SWQgYXMgc3RyaW5nXG4gICAgICAgIHNlc3Npb24udXNlci5mYW1pbHlOYW1lID0gdG9rZW4uZmFtaWx5TmFtZSBhcyBzdHJpbmdcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlzTWVtb3JpYWxBY2NvdW50ID0gdG9rZW4uaXNNZW1vcmlhbEFjY291bnQgYXMgYm9vbGVhblxuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb25cbiAgICB9LFxuICAgIGFzeW5jIHNpZ25Jbih7IHVzZXIsIGFjY291bnQsIHByb2ZpbGUgfSkge1xuICAgICAgLy8gQWRkaXRpb25hbCB2YWxpZGF0aW9uIGZvciBhZG1pbiBhY2NvdW50c1xuICAgICAgaWYgKHVzZXIuaXNBZG1pbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFZlcmlmeSBhZG1pbiByb2xlIGlzIHN0aWxsIGFjdGl2ZSBhbmQgdmFsaWRcbiAgICAgICAgICBjb25zdCBhZG1pbkNoZWNrID0gYXdhaXQgcXVlcnkoYFxuICAgICAgICAgICAgU0VMRUNUIGFyLnJvbGVfbmFtZSwgYXIucGVybWlzc2lvbnMgXG4gICAgICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgICAgIEpPSU4gYWRtaW5fcm9sZXMgYXIgT04gdS5hZG1pbl9yb2xlX2lkID0gYXIuaWRcbiAgICAgICAgICAgIFdIRVJFIHUuaWQgPSAkMSBBTkQgdS5pc19hZG1pbiA9IHRydWUgQU5EIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIGAsIFt1c2VyLmlkXSlcblxuICAgICAgICAgIGlmIChhZG1pbkNoZWNrLnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEFkbWluIHVzZXIgJHt1c2VyLmVtYWlsfSBmYWlsZWQgcm9sZSB2YWxpZGF0aW9uYClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignQWRtaW4gdmFsaWRhdGlvbiBlcnJvcjonLCBlcnJvcilcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH0sXG4gIGV2ZW50czoge1xuICAgIGFzeW5jIHNpZ25PdXQoeyB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4/LmVtYWlsKSB7XG4gICAgICAgIGF3YWl0IGxvZ0FkbWluQWN0aW9uKHtcbiAgICAgICAgICBhZG1pbl91c2VyX2lkOiB0b2tlbi5pZCBhcyBzdHJpbmcsXG4gICAgICAgICAgYWRtaW5fZW1haWw6IHRva2VuLmVtYWlsLFxuICAgICAgICAgIGFjdGlvbl90eXBlOiAnbG9nb3V0JyxcbiAgICAgICAgICByZXNvdXJjZV90eXBlOiAnYXV0aGVudGljYXRpb24nLFxuICAgICAgICAgIGFjdGlvbl9kZXRhaWxzOiB7IFxuICAgICAgICAgICAgaXNfYWRtaW46IHRva2VuLmlzQWRtaW4sXG4gICAgICAgICAgICByb2xlOiB0b2tlbi5yb2xlTmFtZSBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJpc2tfbGV2ZWw6ICdsb3cnXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCxcbn0iXSwibmFtZXMiOlsiQ3JlZGVudGlhbHNQcm92aWRlciIsImJjcnlwdCIsInF1ZXJ5IiwibG9nQWRtaW5BY3Rpb24iLCJpc0lQQmxvY2tlZCIsImF1dGhPcHRpb25zIiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJwYXNzd29yZCIsImF1dGhvcml6ZSIsInJlcSIsImNsaWVudElQIiwiaGVhZGVycyIsImNvbnNvbGUiLCJ3YXJuIiwicmVzdWx0Iiwicm93cyIsImxlbmd0aCIsImFkbWluX2VtYWlsIiwiYWN0aW9uX3R5cGUiLCJyZXNvdXJjZV90eXBlIiwiYWN0aW9uX2RldGFpbHMiLCJyZWFzb24iLCJpcF9hZGRyZXNzIiwidW5kZWZpbmVkIiwidXNlcl9hZ2VudCIsInJpc2tfbGV2ZWwiLCJ1c2VyIiwibG9ja2VkX3VudGlsIiwiRGF0ZSIsImlzUGFzc3dvcmRWYWxpZCIsImNvbXBhcmUiLCJwYXNzd29yZF9oYXNoIiwiaWQiLCJhdHRlbXB0cyIsImZhaWxlZF9sb2dpbl9hdHRlbXB0cyIsInRhcmdldF91c2VyX2lkIiwiYWRtaW5fdXNlcl9pZCIsImlzX2FkbWluIiwicm9sZSIsInJvbGVfbmFtZSIsImZhbWlseV9pZCIsInRvU3RyaW5nIiwiaXNBZG1pbiIsImFkbWluUm9sZUlkIiwiYWRtaW5fcm9sZV9pZCIsInJvbGVOYW1lIiwicm9sZURpc3BsYXlOYW1lIiwicm9sZV9kaXNwbGF5X25hbWUiLCJwZXJtaXNzaW9ucyIsImZhbWlseUlkIiwiZmFtaWx5TmFtZSIsImZhbWlseV9uYW1lIiwiaXNNZW1vcmlhbEFjY291bnQiLCJtZW1vcmlhbF9hY2NvdW50IiwiZXJyb3IiLCJtZXNzYWdlIiwicGFnZXMiLCJzaWduSW4iLCJzaWduT3V0Iiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwibWF4QWdlIiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJhY2NvdW50IiwicHJvZmlsZSIsImFkbWluQ2hlY2siLCJldmVudHMiLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVEFVVEhfU0VDUkVUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkDatabaseHealth: () => (/* binding */ checkDatabaseHealth),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   getClient: () => (/* binding */ getClient),\n/* harmony export */   getQueryMetrics: () => (/* binding */ getQueryMetrics),\n/* harmony export */   handleDbError: () => (/* binding */ handleDbError),\n/* harmony export */   pool: () => (/* binding */ pool),\n/* harmony export */   query: () => (/* binding */ query),\n/* harmony export */   resetQueryMetrics: () => (/* binding */ resetQueryMetrics)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__]);\npg__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL,\n    max: 20,\n    idleTimeoutMillis: 30000,\n    connectionTimeoutMillis: 2000\n});\n\nconst db = {\n    query,\n    getClient,\n    pool\n};\nasync function query(text, params) {\n    const start = Date.now();\n    queryMetrics.totalQueries++;\n    try {\n        const res = await pool.query(text, params);\n        const duration = Date.now() - start;\n        queryMetrics.totalTime += duration;\n        if (duration > 1000) {\n            queryMetrics.slowQueries++;\n        }\n        console.log(\"Executed query\", {\n            text: text.substring(0, 100),\n            duration,\n            rows: res.rowCount\n        });\n        return res;\n    } catch (error) {\n        const duration = Date.now() - start;\n        queryMetrics.totalTime += duration;\n        queryMetrics.errors++;\n        console.error(\"Query failed\", {\n            text: text.substring(0, 100),\n            duration,\n            error: error.message,\n            code: error.code,\n            detail: error.detail\n        });\n        throw error;\n    }\n}\nasync function getClient() {\n    const client = await pool.connect();\n    return client;\n}\n// Query metrics tracking\nlet queryMetrics = {\n    totalQueries: 0,\n    totalTime: 0,\n    slowQueries: 0,\n    errors: 0,\n    lastReset: new Date()\n};\n// Database health monitoring functions\nasync function checkDatabaseHealth() {\n    try {\n        const start = Date.now();\n        await pool.query(\"SELECT 1\");\n        const latency = Date.now() - start;\n        const stats = await pool.query(`\n      SELECT \n        count(*) as total_connections,\n        count(*) filter (where state = 'active') as active_connections,\n        count(*) filter (where state = 'idle') as idle_connections\n      FROM pg_stat_activity \n      WHERE datname = current_database()\n    `);\n        return {\n            status: \"healthy\",\n            latency,\n            connections: stats.rows[0],\n            pool: {\n                totalCount: pool.totalCount,\n                idleCount: pool.idleCount,\n                waitingCount: pool.waitingCount\n            },\n            metrics: queryMetrics\n        };\n    } catch (error) {\n        return {\n            status: \"unhealthy\",\n            error: error instanceof Error ? error.message : \"Unknown error\",\n            metrics: queryMetrics\n        };\n    }\n}\nfunction getQueryMetrics() {\n    return {\n        ...queryMetrics\n    };\n}\nfunction resetQueryMetrics() {\n    queryMetrics = {\n        totalQueries: 0,\n        totalTime: 0,\n        slowQueries: 0,\n        errors: 0,\n        lastReset: new Date()\n    };\n    return queryMetrics;\n}\n// Helper function to handle database errors\nfunction handleDbError(error) {\n    queryMetrics.errors++;\n    console.error(\"Database error:\", error);\n    if (error.code === \"23505\") {\n        throw new Error(\"A user with this email already exists\");\n    }\n    if (error.code === \"23503\") {\n        throw new Error(\"Referenced record does not exist\");\n    }\n    throw new Error(\"Database operation failed\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUljLE1BQU07SUFDbEI7SUFDQSxJQUFJakIsTUFBTUcsSUFBSSxLQUFLLFNBQVM7UUFDMUIsTUFBTSxJQUFJYyxNQUFNO0lBQ2xCO0lBQ0EsTUFBTSxJQUFJQSxNQUFNO0FBQ2xCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWNob3NvZm1lLy4vbGliL2RiLnRzPzFkZjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9vbCB9IGZyb20gJ3BnJ1xuXG5jb25zdCBwb29sID0gbmV3IFBvb2woe1xuICBjb25uZWN0aW9uU3RyaW5nOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gIG1heDogMjAsXG4gIGlkbGVUaW1lb3V0TWlsbGlzOiAzMDAwMCxcbiAgY29ubmVjdGlvblRpbWVvdXRNaWxsaXM6IDIwMDAsXG59KVxuXG5leHBvcnQgeyBwb29sIH1cbmV4cG9ydCBjb25zdCBkYiA9IHsgcXVlcnksIGdldENsaWVudCwgcG9vbCB9XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBxdWVyeSh0ZXh0OiBzdHJpbmcsIHBhcmFtcz86IGFueVtdKSB7XG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKVxuICBxdWVyeU1ldHJpY3MudG90YWxRdWVyaWVzKytcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgcG9vbC5xdWVyeSh0ZXh0LCBwYXJhbXMpXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRcbiAgICBxdWVyeU1ldHJpY3MudG90YWxUaW1lICs9IGR1cmF0aW9uXG4gICAgXG4gICAgaWYgKGR1cmF0aW9uID4gMTAwMCkge1xuICAgICAgcXVlcnlNZXRyaWNzLnNsb3dRdWVyaWVzKytcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0V4ZWN1dGVkIHF1ZXJ5JywgeyB0ZXh0OiB0ZXh0LnN1YnN0cmluZygwLCAxMDApLCBkdXJhdGlvbiwgcm93czogcmVzLnJvd0NvdW50IH0pXG4gICAgcmV0dXJuIHJlc1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRcbiAgICBxdWVyeU1ldHJpY3MudG90YWxUaW1lICs9IGR1cmF0aW9uXG4gICAgcXVlcnlNZXRyaWNzLmVycm9ycysrXG4gICAgXG4gICAgY29uc29sZS5lcnJvcignUXVlcnkgZmFpbGVkJywgeyBcbiAgICAgIHRleHQ6IHRleHQuc3Vic3RyaW5nKDAsIDEwMCksIFxuICAgICAgZHVyYXRpb24sIFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgZGV0YWlsOiBlcnJvci5kZXRhaWwgXG4gICAgfSlcbiAgICB0aHJvdyBlcnJvclxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDbGllbnQoKSB7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpXG4gIHJldHVybiBjbGllbnRcbn1cblxuLy8gUXVlcnkgbWV0cmljcyB0cmFja2luZ1xubGV0IHF1ZXJ5TWV0cmljcyA9IHtcbiAgdG90YWxRdWVyaWVzOiAwLFxuICB0b3RhbFRpbWU6IDAsXG4gIHNsb3dRdWVyaWVzOiAwLFxuICBlcnJvcnM6IDAsXG4gIGxhc3RSZXNldDogbmV3IERhdGUoKVxufVxuXG4vLyBEYXRhYmFzZSBoZWFsdGggbW9uaXRvcmluZyBmdW5jdGlvbnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0RhdGFiYXNlSGVhbHRoKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKVxuICAgIGF3YWl0IHBvb2wucXVlcnkoJ1NFTEVDVCAxJylcbiAgICBjb25zdCBsYXRlbmN5ID0gRGF0ZS5ub3coKSAtIHN0YXJ0XG4gICAgXG4gICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBwb29sLnF1ZXJ5KGBcbiAgICAgIFNFTEVDVCBcbiAgICAgICAgY291bnQoKikgYXMgdG90YWxfY29ubmVjdGlvbnMsXG4gICAgICAgIGNvdW50KCopIGZpbHRlciAod2hlcmUgc3RhdGUgPSAnYWN0aXZlJykgYXMgYWN0aXZlX2Nvbm5lY3Rpb25zLFxuICAgICAgICBjb3VudCgqKSBmaWx0ZXIgKHdoZXJlIHN0YXRlID0gJ2lkbGUnKSBhcyBpZGxlX2Nvbm5lY3Rpb25zXG4gICAgICBGUk9NIHBnX3N0YXRfYWN0aXZpdHkgXG4gICAgICBXSEVSRSBkYXRuYW1lID0gY3VycmVudF9kYXRhYmFzZSgpXG4gICAgYClcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiAnaGVhbHRoeScsXG4gICAgICBsYXRlbmN5LFxuICAgICAgY29ubmVjdGlvbnM6IHN0YXRzLnJvd3NbMF0sXG4gICAgICBwb29sOiB7XG4gICAgICAgIHRvdGFsQ291bnQ6IHBvb2wudG90YWxDb3VudCxcbiAgICAgICAgaWRsZUNvdW50OiBwb29sLmlkbGVDb3VudCxcbiAgICAgICAgd2FpdGluZ0NvdW50OiBwb29sLndhaXRpbmdDb3VudFxuICAgICAgfSxcbiAgICAgIG1ldHJpY3M6IHF1ZXJ5TWV0cmljc1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiAndW5oZWFsdGh5JyxcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIG1ldHJpY3M6IHF1ZXJ5TWV0cmljc1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UXVlcnlNZXRyaWNzKCkge1xuICByZXR1cm4geyAuLi5xdWVyeU1ldHJpY3MgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRRdWVyeU1ldHJpY3MoKSB7XG4gIHF1ZXJ5TWV0cmljcyA9IHtcbiAgICB0b3RhbFF1ZXJpZXM6IDAsXG4gICAgdG90YWxUaW1lOiAwLFxuICAgIHNsb3dRdWVyaWVzOiAwLFxuICAgIGVycm9yczogMCxcbiAgICBsYXN0UmVzZXQ6IG5ldyBEYXRlKClcbiAgfVxuICByZXR1cm4gcXVlcnlNZXRyaWNzXG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRGJFcnJvcihlcnJvcjogYW55KSB7XG4gIHF1ZXJ5TWV0cmljcy5lcnJvcnMrK1xuICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBlcnJvcjonLCBlcnJvcilcbiAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgdXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMnKVxuICB9XG4gIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDMnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdSZWZlcmVuY2VkIHJlY29yZCBkb2VzIG5vdCBleGlzdCcpXG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb24gZmFpbGVkJylcbn0iXSwibmFtZXMiOlsiUG9vbCIsInBvb2wiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsIm1heCIsImlkbGVUaW1lb3V0TWlsbGlzIiwiY29ubmVjdGlvblRpbWVvdXRNaWxsaXMiLCJkYiIsInF1ZXJ5IiwiZ2V0Q2xpZW50IiwidGV4dCIsInBhcmFtcyIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInF1ZXJ5TWV0cmljcyIsInRvdGFsUXVlcmllcyIsInJlcyIsImR1cmF0aW9uIiwidG90YWxUaW1lIiwic2xvd1F1ZXJpZXMiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwicm93cyIsInJvd0NvdW50IiwiZXJyb3IiLCJlcnJvcnMiLCJtZXNzYWdlIiwiY29kZSIsImRldGFpbCIsImNsaWVudCIsImNvbm5lY3QiLCJsYXN0UmVzZXQiLCJjaGVja0RhdGFiYXNlSGVhbHRoIiwibGF0ZW5jeSIsInN0YXRzIiwic3RhdHVzIiwiY29ubmVjdGlvbnMiLCJ0b3RhbENvdW50IiwiaWRsZUNvdW50Iiwid2FpdGluZ0NvdW50IiwibWV0cmljcyIsIkVycm9yIiwiZ2V0UXVlcnlNZXRyaWNzIiwicmVzZXRRdWVyeU1ldHJpY3MiLCJoYW5kbGVEYkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/uuid","vendor-chunks/oauth","vendor-chunks/@panva","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/oidc-token-hash","vendor-chunks/bcryptjs","vendor-chunks/preact","vendor-chunks/object-hash","vendor-chunks/lru-cache","vendor-chunks/cookie"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2Fapp%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();